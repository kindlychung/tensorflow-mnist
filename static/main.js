"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Main=function(){function t(){_classCallCheck(this,t),this.canvas=document.getElementById("main"),this.input=document.getElementById("input"),this.canvas.width=449,this.canvas.height=449,this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.initialize()}return _createClass(t,[{key:"initialize",value:function(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,449,449),this.ctx.lineWidth=1,this.ctx.strokeRect(0,0,449,449),this.ctx.lineWidth=.05;for(var t=0;t<27;t++)this.ctx.beginPath(),this.ctx.moveTo(16*(t+1),0),this.ctx.lineTo(16*(t+1),449),this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,16*(t+1)),this.ctx.lineTo(449,16*(t+1)),this.ctx.closePath(),this.ctx.stroke();this.drawInput(),$("#output td").text("").removeClass("success")}},{key:"onMouseDown",value:function(t){this.canvas.style.cursor="default",this.drawing=!0,this.prev=this.getPosition(t.clientX,t.clientY)}},{key:"onMouseUp",value:function(){this.drawing=!1,this.drawInput()}},{key:"onMouseMove",value:function(t){if(this.drawing){var e=this.getPosition(t.clientX,t.clientY);this.ctx.lineWidth=16,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.prev.x,this.prev.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.prev=e}}},{key:"getPosition",value:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"drawInput",value:function(){var t=this.input.getContext("2d"),e=new Image;e.onload=function(){var i=[],n=document.createElement("canvas").getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,28,28);for(var s=n.getImageData(0,0,28,28).data,a=0;a<28;a++)for(var o=0;o<28;o++){var c=4*(28*a+o);i[28*a+o]=(s[c+0]+s[c+1]+s[c+2])/3,t.fillStyle="rgb("+[s[c+0],s[c+1],s[c+2]].join(",")+")",t.fillRect(5*o,5*a,5,5)}255!==Math.min.apply(Math,i)&&$.ajax({url:"/api/mnist",method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(t){for(var e=0;e<2;e++){for(var i=0,n=0,s=0;s<10;s++){var a=Math.round(1e3*t.results[e][s]);a>i&&(i=a,n=s);for(var o=String(a).length,c=0;c<3-o;c++)a="0"+a;var r="0."+a;a>999&&(r="1.000"),$("#output tr").eq(s+1).find("td").eq(e).text(r)}for(var h=0;h<10;h++)h===n?$("#output tr").eq(h+1).find("td").eq(e).addClass("success"):$("#output tr").eq(h+1).find("td").eq(e).removeClass("success");$("#prediction").html(n)}}})},e.src=this.canvas.toDataURL()}}]),t}();$(function(){var t=new Main;$("#clear").click(function(){t.initialize()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJNYWluIiwidGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbnB1dCIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbk1vdXNlRG93biIsImJpbmQiLCJvbk1vdXNlVXAiLCJvbk1vdXNlTW92ZSIsImluaXRpYWxpemUiLCJ2YWx1ZSIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwibGluZVdpZHRoIiwic3Ryb2tlUmVjdCIsImJlZ2luUGF0aCIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlUGF0aCIsInN0cm9rZSIsImRyYXdJbnB1dCIsIiQiLCJ0ZXh0IiwicmVtb3ZlQ2xhc3MiLCJlIiwic3R5bGUiLCJjdXJzb3IiLCJkcmF3aW5nIiwicHJldiIsImdldFBvc2l0aW9uIiwiY2xpZW50WCIsImNsaWVudFkiLCJjdXJyIiwibGluZUNhcCIsIngiLCJ5IiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImxlZnQiLCJ0b3AiLCJpbWciLCJJbWFnZSIsIm9ubG9hZCIsImlucHV0cyIsInNtYWxsIiwiY3JlYXRlRWxlbWVudCIsImRyYXdJbWFnZSIsImRhdGEiLCJnZXRJbWFnZURhdGEiLCJqIiwibiIsImpvaW4iLCJNYXRoIiwibWluIiwiYXBwbHkiLCJhamF4IiwidXJsIiwibWV0aG9kIiwiY29udGVudFR5cGUiLCJKU09OIiwic3RyaW5naWZ5Iiwic3VjY2VzcyIsIl9pIiwibWF4IiwibWF4X2luZGV4IiwiX2oiLCJyb3VuZCIsInJlc3VsdHMiLCJkaWdpdHMiLCJTdHJpbmciLCJrIiwiZXEiLCJmaW5kIiwiX2oyIiwiYWRkQ2xhc3MiLCJodG1sIiwic3JjIiwidG9EYXRhVVJMIiwibWFpbiIsImNsaWNrIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWMsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZQSxFQUFXRyxVQUFXLEdBQU1DLE9BQU9DLGVBQWVULEVBQVFJLEVBQVdNLElBQUtOLElBQWlCLE1BQU8sVUFBVVIsRUFBYWUsRUFBWUMsR0FBaUosTUFBOUhELElBQVlaLEVBQWlCSCxFQUFZaUIsVUFBV0YsR0FBaUJDLEdBQWFiLEVBQWlCSCxFQUFhZ0IsR0FBcUJoQixNQUs1aEJrQixLQUFPLFdBQ1AsUUFBU0EsS0FDTHBCLGdCQUFnQnFCLEtBQU1ELEdBRXRCQyxLQUFLQyxPQUFTQyxTQUFTQyxlQUFlLFFBQ3RDSCxLQUFLSSxNQUFRRixTQUFTQyxlQUFlLFNBQ3JDSCxLQUFLQyxPQUFPSSxNQUFRLElBQ3BCTCxLQUFLQyxPQUFPSyxPQUFTLElBQ3JCTixLQUFLTyxJQUFNUCxLQUFLQyxPQUFPTyxXQUFXLE1BQ2xDUixLQUFLQyxPQUFPUSxpQkFBaUIsWUFBYVQsS0FBS1UsWUFBWUMsS0FBS1gsT0FDaEVBLEtBQUtDLE9BQU9RLGlCQUFpQixVQUFXVCxLQUFLWSxVQUFVRCxLQUFLWCxPQUM1REEsS0FBS0MsT0FBT1EsaUJBQWlC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LEtBQ2YyQixHQUFFLFVBQVUwRCxNQUFNLFdBQ2RELEVBQUtyRSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG4vKiBnbG9iYWwgJCAqL1xudmFyIE1haW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbigpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1haW4pO1xuXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4nKTtcbiAgICAgICAgdGhpcy5pbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpO1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IDQ0OTsgLy8gMTYgKiAyOCArIDFcbiAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gNDQ5OyAvLyAxNiAqIDI4ICsgMVxuICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMub25Nb3VzZURvd24uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm9uTW91c2VVcC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdXNlTW92ZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplKCk7XG4gICAgfVxuXG4gICAgX2NyZWF0ZUNsYXNzKE1haW4sIFt7XG4gICAgICAgIGtleTogJ2luaXRpYWxpemUnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9ICcjRkZGRkZGJztcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIDQ0OSwgNDQ5KTtcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgICAgICAgICB0aGlzLmN0eC5zdHJva2VSZWN0KDAsIDAsIDQ0OSwgNDQ5KTtcbiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDAuMDU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI3OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8oKGkgKyAxKSAqIDE2LCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oKGkgKyAxKSAqIDE2LCA0NDkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKDAsIChpICsgMSkgKiAxNik7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKDQ0OSwgKGkgKyAxKSAqIDE2KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZHJhd0lucHV0KCk7XG4gICAgICAgICAgICAkKCcjb3V0cHV0IHRkJykudGV4dCgnJykucmVtb3ZlQ2xhc3MoJ3N1Y2Nlc3MnKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnb25Nb3VzZURvd24nLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZURvd24oZSkge1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnO1xuICAgICAgICAgICAgdGhpcy5kcmF3aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucHJldiA9IHRoaXMuZ2V0UG9zaXRpb24oZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdvbk1vdXNlVXAnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZVVwKCkge1xuICAgICAgICAgICAgdGhpcy5kcmF3aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmRyYXdJbnB1dCgpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdvbk1vdXNlTW92ZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vdXNlTW92ZShlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kcmF3aW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnIgPSB0aGlzLmdldFBvc2l0aW9uKGUuY2xpZW50WCwgZS5jbGllbnRZKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSAxNjtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lQ2FwID0gJ3JvdW5kJztcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8odGhpcy5wcmV2LngsIHRoaXMucHJldi55KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oY3Vyci54LCBjdXJyLnkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMucHJldiA9IGN1cnI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2dldFBvc2l0aW9uJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBvc2l0aW9uKGNsaWVudFgsIGNsaWVudFkpIHtcbiAgICAgICAgICAgIHZhciByZWN0ID0gdGhpcy5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHg6IGNsaWVudFggLSByZWN0LmxlZnQsXG4gICAgICAgICAgICAgICAgeTogY2xpZW50WSAtIHJlY3QudG9wXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdkcmF3SW5wdXQnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhd0lucHV0KCkge1xuICAgICAgICAgICAgdmFyIGN0eCA9IHRoaXMuaW5wdXQuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0cyA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBzbWFsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICAgICAgc21hbGwuZHJhd0ltYWdlKGltZywgMCwgMCwgaW1nLndpZHRoLCBpbWcuaGVpZ2h0LCAwLCAwLCAyOCwgMjgpO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gc21hbGwuZ2V0SW1hZ2VEYXRhKDAsIDAsIDI4LCAyOCkuZGF0YTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAyODsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IDQgKiAoaSAqIDI4ICsgaik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dHNbaSAqIDI4ICsgal0gPSAoZGF0YVtuICsgMF0gKyBkYXRhW24gKyAxXSArIGRhdGFbbiArIDJdKSAvIDM7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYignICsgW2RhdGFbbiArIDBdLCBkYXRhW24gKyAxXSwgZGF0YVtuICsgMl1dLmpvaW4oJywnKSArICcpJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChqICogNSwgaSAqIDUsIDUsIDUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChNYXRoLm1pbi5hcHBseShNYXRoLCBpbnB1dHMpID09PSAyNTUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYXBpL21uaXN0JyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGlucHV0cyksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IDI7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF4X2luZGV4ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgMTA7IF9qKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gTWF0aC5yb3VuZChkYXRhLnJlc3VsdHNbX2ldW19qXSAqIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiBtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2luZGV4ID0gX2o7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpZ2l0cyA9IFN0cmluZyh2YWx1ZSkubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IDMgLSBkaWdpdHM7IGsrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnMCcgKyB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9ICcwLicgKyB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gOTk5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gJzEuMDAwJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjb3V0cHV0IHRyJykuZXEoX2ogKyAxKS5maW5kKCd0ZCcpLmVxKF9pKS50ZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfajIgPSAwOyBfajIgPCAxMDsgX2oyKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9qMiA9PT0gbWF4X2luZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjb3V0cHV0IHRyJykuZXEoX2oyICsgMSkuZmluZCgndGQnKS5lcShfaSkuYWRkQ2xhc3MoJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNvdXRwdXQgdHInKS5lcShfajIgKyAxKS5maW5kKCd0ZCcpLmVxKF9pKS5yZW1vdmVDbGFzcygnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcHJlZGljdGlvblwiKS5odG1sKG1heF9pbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpbWcuc3JjID0gdGhpcy5jYW52YXMudG9EYXRhVVJMKCk7XG4gICAgICAgIH1cbiAgICB9XSk7XG5cbiAgICByZXR1cm4gTWFpbjtcbn0oKTtcblxuJChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1haW4gPSBuZXcgTWFpbigpO1xuICAgICQoJyNjbGVhcicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbWFpbi5pbml0aWFsaXplKCk7XG4gICAgfSk7XG59KTsiXX0=
